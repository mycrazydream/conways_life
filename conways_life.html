<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Conway&apos;s Game of Life with D3.js</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Brent Ransom">
	<!-- Date: 2014-09-13 -->
	<script src="jquery.min.js"></script>
	<script src="d3.v3.min.js"></script>
	<script>
	/*
	conways_game_of_life.js

	Created by Brent Ransom on 2016-10-10.
	Copyright &copy; 2016 mycrazydream. All rights reserved.

	Conway's Game of Life
	http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life

	Axiom 1. Any live cell with fewer than two live neighbours dies, as if caused by under-population.
	Axiom 2. Any live cell with two or three live neighbours lives on to the next generation.
	Axiom 3. Any live cell with more than three live neighbours dies, as if by overcrowding.
	Axiom 4. Any dead cell with exactly three live neighbours becomes a live cell, as if by reproduction.
	*/

$(function() {

	function Life(args){
		var args 	= args || {},
			$ 		= args.$,
			that 	= this,
			C 		= {};
		
		/* Using D3 to handle the graphics on the client-side. Works particularly well for a 2D board
		since it is used for charts and the like. SVG

		int 	xscale 	Width of our box
		int 	yscale 	Height of our box
		string	div 	ID of the div container
		*/
		this.drawBoxes = function(xscale, yscale, div) {
	        var gray 		= "stroke:#FFFFFF; fill: #CCC",
				black 		= "stroke:#FFFFFF; fill: #000000",
			    blue 		= "stroke:#FFFFFF; fill: #0000FF",
			    green 		= "stroke:#FFFFFF; fill: #00CC00",
			    red 		= "stroke:#FFFFFF; fill: #FF0000",
				// total number of cells
				n			= xscale*yscale,
				// size of cell in pixels
				length 		= 10,
				// lines between the cells, for that grid look
		        whitespace 	= 2,
				color		= gray,
				width		= 10,
				height		= 10;
				
			C.ALIVECOLOR 	= green;
			C.DEADCOLOR		= gray;

			/*partial boxes not applicable (yet) to CGOL
	        if ((n % 10) != 0) {
	          //ch += 10;
	        }*/
	        var rects = d3.select("#" + div).
	         append("svg:svg").
	         attr("width", xscale*length+xscale*2).
	         attr("height", yscale*length+yscale*2);
			
			var rIncrement = 0;
	        for (var y = 0; y < yscale; y++) {
	            for (var x = 0; x < xscale; x++) {
					//if we want to color the rows I was using this
					//caseTest = ((y+'').substr(0,(y+'').length-1))*1,
						
					rIncrement++;
	                rects.append("svg:rect").
	                  attr("x", x*length).
	                  attr("y", y*length).
	                  attr("height", height).
	                  attr("width", width).
	                  attr("style", color).
					  attr("class", "rect r"+rIncrement+" x"+x+" y"+y);
					
					
					
	                n--;
	                if (n === 0) {
						$('#life .rect').click(function(e){ 
							$(this).attr("style", C.ALIVECOLOR).val(1);
							that.cell($(this).attr("x")*1/10, $(this).attr("y")*1/10, 1);
						});
						return;
	                }
	            }
	        }
	    }
		
		/* Nice conversion of python range fn
		
		int low		Bottom value of range
		int high 	Top value of range

		*/
		this.range = function(low, high) {  
		    return {
		        __iterator__: function() {
		            return {  
		                next: function() {
		                    if (low > high)
		                        throw StopIteration;  
		                    return low++;
		                }
		            }
		        }
		    }
		}
		
		/*
		int 	x	x coordinate on grid
		int 	y 	y coordinate on grid
		bool	return
		*/
		this.cellExists = function(x,y){
			var cellExists = false
			if(typeof(C.BOARD[x])!=="undefined" && typeof(C.BOARD[x][y])!=="undefined"){cellExists = true;}
			
			return cellExists;
		}
		
		/* Getter/setter
		
		int x Key of first list (row #)
		int y Key of second list (col #)
		int v Value to set the cell on the board
		*/
		this.cell = function(x,y,v,temp){
			if(typeof(v)==="number"){
				if(temp===true){
					C.TEMPBOARD[x][y] = v;
				} else {
					C.BOARD[x][y] = v;
				}
			} else {
				if(temp===true){
					return C.TEMPBOARD[x][y];
				} else {
					return C.BOARD[x][y];
				}
			}
		}
		
		/*
		Any live cell with fewer than two live neighbors dies, as if caused by under-population.
		
		list neighbors Is a list of values 0 or 1 of the eight surrounding neighbor cells
		*/
		this.axiomOne = function(liveNeighbors){
			return (liveNeighbors < 2) 
				? true 
				: false;
		}
		
		/*
		Any live cell with two or three live neighbors lives on to the next generation.

		list neighbors Is a list of values 0 or 1 of the eight surrounding neighbor cells
		*/
		this.axiomTwo = function(liveNeighbors){
			return (liveNeighbors === 2 || liveNeighbors === 3) 
				? true 
				: false;
		}
		
		/*
		Any live cell with more than three live neighbors dies, as if by overcrowding.

		list neighbors Is a list of values 0 or 1 of the eight surrounding neighbor cells
		*/
		this.axiomThree = function(liveNeighbors){
			return (liveNeighbors >= 3) 
				? true 
				: false;
		}
			
		/*
		Any dead cell with exactly three live neighbors becomes a live cell, as if by reproduction.

		list neighbors Is a list of values 0 or 1 of the eight surrounding neighbor cells
		*/
		this.axiomFour = function(liveNeighbors){
			return (liveNeighbors === 3) 
				? true 
				: false;
		}
			
		/*
		Given a cell on the board, test its next generation according to the four axioms of Conway's Game of Life

		list 	neighbors 	Is a list of values 0 or 1 of the eight surrounding neighbor cells
		int 	cell 		Value of the cell we are testing, changes the axiom rule logic
		int		return 
		*/
		this.conwayAxioms = function(neighbors, cell){
			var nextGenCell = 0,
				liveNeighbors=0;
				
			for (var i in neighbors){
				if(neighbors[i]!==1 && neighbors[i]!==0){
					throw("Error in neighbors list, only values of 1 or 0 are allowed. Bad value: "+neighbors[i]);
				}
				liveNeighbors += neighbors[i];
			}
			
			if (cell===0){//dead cell
				if (that.axiomFour(liveNeighbors)){
					nextGenCell = 1;
				}
			} else if(cell===1){//live cell
				if (that.axiomOne(liveNeighbors)){
					nextGenCell = 0;
				} else if(that.axiomTwo(liveNeighbors)){
					nextGenCell = 1;
				} else if(that.axiomThree(liveNeighbors)){
					nextGenCell = 0;
				}
			}

			return nextGenCell;
		}
		
		/*
		Get the values of all the cells surrounding the cell in question. 
		The crux of the game, as it were.
		int x 			x coordinate
		int y			y coordinate
		int neighbor	0-7 the 8 neighbors arround the cell
		
		Our eight neighbors, with the CELL in the center
		|0|1|2|
		|7|C|3|
		|6|5|4|
		*/
		this.getNeighborValue = function(x,y,neighbor){
			var nValue 	= 0,
				nX		= 0,
				nY		= 0;

			neighbor*=1;
			switch(neighbor){
				case 0:
					nX = x-1;
					nY = y-1;
				break;
				case 1:
					nX = x;
					nY = y-1;
				break;
				case 2:
					nX = x+1;
					nY = y-1;
				break;
				case 3:
					nX = x+1;
					nY = y;
				break;
				case 4:
					nX = x+1;
					nY = y+1;
				break;
				case 5:
					nX = x;
					nY = y+1;
				break;
				case 6:
					nX = x-1;
					nY = y+1;
				break;
				case 7:
					nX = x-1;
					nY = y;
				break;
				default:
					throw("Error, cell cannot have more than 8 neighbors. Neighbor value choked on: "+neighbor);
			}
			
			nValue = (that.cellExists(nX, nY)) ? C.BOARD[nX][nY] : 0;
			
			return nValue;
		}
		
		/*
		Grab the neighbors of the cell defined by i,j and pass them on so that the cell can be tested according 
		to their values
		
		int x Key of first list (row #)
		int y Key of second list (col #)
		int r Individual cell marker used in dom class (never ended up using this...)
		*/
		this.testNeighbors = function(x,y,r){
			var cell = 0;
			if(C.XSCALE>=x && C.YSCALE>=y){
				cell = C.BOARD[x][y];
			}
			
			/*
			Our eight neighbors, with the CELL in the center
			|0|1|2|
			|7|C|3|
			|6|5|4|
			*/
			var neighbors = [0,0,0,0,0,0,0,0];
			for (var i in neighbors){
				neighbors[i] = that.getNeighborValue(x,y,i);
			}

			//Run through Conway algorithm
			var nextGenCell = that.conwayAxioms(neighbors,cell);
			
			//set new value
			that.cell(x,y,nextGenCell,true);
		}
		
		/*
		Translate our 2D array to graphics for the kids at home
		*/
		this.updateBoardDisplay = function(){
			for (var x in that.range(0, C.XSCALE-1)){
				for (var y in that.range(0, C.YSCALE-1)){
					var v = C.BOARD[x][y];
					if(v===1){
						$(".x"+x+".y"+y).attr("style", C.ALIVECOLOR).val(1);
					} else {
						$(".x"+x+".y"+y).attr("style", C.DEADCOLOR).val(0);
					}
				}
			}
		}
		
		/*
		Run the board through all its tests/axioms for the generation
		*/
		this.testBoard = function(){
			var xRange 			= C.XSCALE,
				yRange 			= C.YSCALE,
				cellIncrement 	= 0;
				
			for (var x=0; x<xRange; x++){
				for (var y=0; y<yRange; y++){
					that.testNeighbors(x,y,cellIncrement);
					cellIncrement++;
				}
			} 
		}
	
		this.passAGeneration = function(){
			/*
			Recursive fn to run the evolution of each generation
			*/
			if($("#stopGag").val()!=="stop"){
				that.generation++;
				that.testBoard();
				for (var i in that.range(0, C.XSCALE-1)){
					for (var j in that.range(0, C.YSCALE-1)){
						C.BOARD[i][j] = C.TEMPBOARD[i][j];
					}
				}
				that.clearTempBoard();
				that.updateBoardDisplay();
			}
		}

		this.beginLife = function(){
			console.log("Life has started");
			$("#stopGag").val("start");
			C.gameTimer = window.setInterval(that.passAGeneration,500);
		}
		
		this.endLife = function(){
			window.clearInterval(C.gameTimer);
			$("#stopGag").val("stop");
			console.log("Life has ended");
		}
		
		/*
		We need a temp board or else the logic overlaps and
		screws up the whole game
		*/
		this.generateBoards = function(){
			for (var i in that.range(0, C.XSCALE-1)){
				if(!C.BOARD[i]) C.BOARD[i] = [];
				if(!C.TEMPBOARD[i]) C.TEMPBOARD[i] = [];
				for (var j in that.range(0, C.YSCALE-1)){
					C.TEMPBOARD[i][j] = 0;
					C.BOARD[i][j] = 0;
				}
			}
		}
		
		//reset
		this.clearTempBoard = function(){
			for (var i in that.range(0, C.XSCALE-1)){
				for (var j in that.range(0, C.YSCALE-1)){
					C.TEMPBOARD[i][j] = 0;
				}
			}
		}
		
		// private constructor 
		var __construct__ = function(that) {
			console.log('life has been instantiated');
			that.generation 	= 0;
			
			/* CONSTANTS */
			C.XSCALE 	= 50;
			C.YSCALE	= 25;
			C.BOARD		= [];
			C.TEMPBOARD = [];
			C.gameTimer	= {};

			that.generateBoards();
			that.drawBoxes(C.XSCALE, C.YSCALE, 'life');
		}(this);
	}
	//end class Life()
	window.life = new Life({
		$: 		jQuery
	});
});
	
	</script>
	<style>
		#life { width: 260px; height:260px; }
		#ct { border:1px solid #333;border-radius:5px;margin:6px auto;padding:6px;background-color:white;text-align:center;width:500px; }
		p, author { margin:4px; padding: 8px;}
		body { font-family:Verdana, Monaco, sans-serif;width:100%;height:100%;margin:0;padding:0;font-size:12px; }
		div.thumbinner {
		    background-color: #f9f9f9;
		    border: 1px solid #ccc;
		    font-size: 94%;
		    overflow: hidden;
		    padding: 3px;
		    text-align: center;
		}
		.thumbinner {
		    min-width: 100px;
		}
	</style>
</head>
<body>
	<div style="width:16%;float:right;margin:10px;" class="thumbinner">
		<a class="image" href="http://www.wikipedia.org/wiki/File:Gospers_glider_gun.gif" target="_blank">
			<img width="250" height="180" data-file-height="180" data-file-width="250" class="thumbimage" src="http://upload.wikimedia.org/wikipedia/commons/e/e5/Gospers_glider_gun.gif" alt=""></a>
			<div class="thumbcaption">A single <a title="Bill Gosper" href="http://www.wikipedia.org/wiki/Bill_Gosper" target="_blank">Gosper</a>'s 
				<a title="Gun (cellular automaton)" href="http://www.wikipedia.org/wiki/Gun_(cellular_automaton)" target="_blank">Glider Gun</a> creating "
				<a title="Glider (Conway's Life)" href="http://www.wikipedia.org/wiki/Glider_(Conway%27s_Life)" target="_blank">gliders</a>"
			</div>
	</div>
	<div style="float:left;width:80%;">
	<header>
		<author>
		Created by Brent Ransom on 2016-10-10.
		<p>Copyright &copy; 2016 mycrazydream. All rights reserved.</p>
		</author>
		<p>
			
			Please refer to the link here to see what this is all about. There is a lot to it, and it has interesting implications
			to evolution, biological life, and mathematics. But... simply click the squares you want to seed the board with and hit Start.
			Some patterns do more interesting things than others. The wikipedia page will tell you about them if you don't want to hunt.
			If you can create a gun or regenerative pattern you are on your way! Code available on <a href="https://github.com/mycrazydream/conways_life" target="_blank">GitHib</a>, 
			or just view the source.
			
			<br style="clear:both;">
		</p>
		<p>
		<a href="http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life" target="_blank" title="Conway's Game of Life" style="display:block;">Conway's Game of Life</a>
		<span>4 Axioms to Conway's Game of Life</span>
		</p>
		<ol>
			<li>Any live cell with fewer than two live neighbors dies, as if caused by under-population.</li>
			<li>Any live cell with two or three live neighbors lives on to the next generation.</li>
			<li>Any live cell with more than three live neighbors dies, as if by overcrowding.</li>
			<li>Any dead cell with exactly three live neighbors becomes a live cell, as if by reproduction.</li>
		</ol>
	</header>
	<div id="ct">
		<div id="life"></div>
		<button type="button" id="beginLife" onclick="life.beginLife();" name="startBtn">Start the Game of Life</button> - <button type="button" id="endLife" onclick="life.endLife();" name="endBtn">End the Game of Life</button>
		<input type="hidden" id="stopGag" value="start" />
	</div>
	</div>
	
	
</body>
</html>